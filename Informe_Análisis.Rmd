---
title: "Identificación de genes que intervienen en la patogénesis del síndrome de Turner"
author: "Félix Francisco Enríquez Romero"
date: "20/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## INDICE
[1.Abstract](#abstract)

[2.Objetivos](#objetivos)

[3.Materiales y métodos](#matmet)

[3.1.Naturaleza de los datos, tipo de experimento, diseño experimental y tipo de microarrays utilizados](#datos)
  
[3.2.Métodos utilizados en el análisis (Pipeline)](#pipeline)
  
[3.3.Descripción cualitativa de cada paso](#steps)

[4.Resultados del análisis](#resultados)

[5.Discusión](#dicusion)

[6.Apéndice](#apendice)




## 1.Abstract {#abstract}

## 2.Objetivos {#objetivos}

## 3.Materiales y métodos {#matmet}

## 3.1.Naturaleza de los datos, tipo de experimento, diseño experimental y tipo de microarrays utilizados {#datos}

## 3.2.Métodos utilizados en el análisis (Pipeline) {#pipeline}

## 3.3.Descripción cualitativa de cada paso {#steps}

## 4.Resultados del análisis {#resultados}

## 5.Discusión {#dicusion}

## 6.Apéndice {#apendice}

```{r imports, message=FALSE}
if (!(require(BiocManager))) install.packages("BiocManager")
if (!require(affy))BiocManager::install("affy")
if (!require(Biobase))BiocManager::install("Biobase")
if (!require(simpleaffy))BiocManager::install("simpleaffy")
if (!require(affyPLM))BiocManager::install("affyPLM")
```


```{r load}
library(Biobase)
library(affy)

# Directorios
workingDir <- getwd()
rawDataDir <- file.path(workingDir, "raw_data")
resultsDir <- file.path(workingDir, "results")

# Función para elegir muestras aleatoriamente
selectSamples<- function (myID){
 set.seed(myID)
 selected <- c(sample(1:10, 6),11, sample(12:26, 5), sample(27:36,6))
 selected <- sort(selected)
}

# Seleccionamos las muestras y almacenamos el nombre de los archivos .CEL
mySelected <- selectSamples(49044820)
targetsAll <- read.csv(file="targetsAll.csv", row.names = 1, head=TRUE)
myTargets <- targetsAll[mySelected,]
fileNames <- row.names(myTargets)

# Obtenemos el nombre completo de los archivos .CEL
all_files <- list.files("raw_data/", pattern = "*.CEL.gz", full.names = FALSE) # Todos
selectFiles <- c() # Los que se necesitan
for(i in 1:length(all_files)){
  fullName = all_files[i]
  name = unlist(strsplit(fullName,"_"))[1] 
  if(is.element(name,fileNames)){ # Si el nombre está en nuestro listado entonces lo añadimos
    selectFiles <- c(selectFiles,fullName)
  }
}

# Por último leemos los archivos .CEL que nos interesa y creamos un objeto de tipo AffyBatch
rawData <- read.affybatch(filenames = file.path(rawDataDir,selectFiles),phenoData=AnnotatedDataFrame(myTargets))

# Los grupos presentes en el experimento son
unique(myTargets["karyotype"])

# Tipo de placa
cdfName(rawData)

library(simpleaffy)
library(affyPLM)
# Control de calidad en crudo
qualityAnalysisRaw <- qc(rawData)
plot(qualityAnalysisRaw)

# Normalización
processedData <- affy::rma(rawData)
```

