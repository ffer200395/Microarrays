---
title: "Identificación de genes que intervienen en la patogénesis del síndrome de Turner"
author: "Félix Francisco Enríquez Romero"
date: "20/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## INDICE
[1.Abstract](#abstract)

[2.Objetivos](#objetivos)

[3.Materiales y métodos](#matmet)

[3.1.Naturaleza de los datos, tipo de experimento, diseño experimental y tipo de microarrays utilizados](#datos)
  
[3.2.Métodos utilizados en el análisis (Pipeline)](#pipeline)
  
[3.3.Descripción cualitativa de cada paso](#steps)

[4.Resultados del análisis](#resultados)

[5.Discusión](#dicusion)

[6.Apéndice](#apendice)




## 1.Abstract {#abstract}

## 2.Objetivos {#objetivos}

## 3.Materiales y métodos {#matmet}

## 3.1.Naturaleza de los datos, tipo de experimento, diseño experimental y tipo de microarrays utilizados {#datos}

## 3.2.Métodos utilizados en el análisis (Pipeline) {#pipeline}

## 3.3.Descripción cualitativa de cada paso {#steps}

## 4.Resultados del análisis {#resultados}

## 5.Discusión {#dicusion}

## 6.Apéndice {#apendice}

```{r imports, message=FALSE}
if (!(require(BiocManager))) install.packages("BiocManager")
if (!require(affy))BiocManager::install("affy")
if (!require(Biobase))BiocManager::install("Biobase")
if (!require(simpleaffy))BiocManager::install("simpleaffy")
if (!require(affyPLM))BiocManager::install("affyPLM")
```

```{r load_norm}
library(Biobase)
library(affy)

# Directorios
workingDir <- getwd()
rawDataDir <- file.path(workingDir, "raw_data")
resultsDir <- file.path(workingDir, "results")

# Función para elegir muestras aleatoriamente
selectSamples<- function (myID){
 set.seed(myID)
 selected <- c(sample(1:10, 6),11, sample(12:26, 5), sample(27:36,6))
 selected <- sort(selected)
}

# Seleccionamos las muestras y almacenamos el nombre de los archivos .CEL
mySelected <- selectSamples(49044820)
targetsAll <- read.csv(file="targetsAll.csv", row.names = 1, head=TRUE)
myTargets <- targetsAll[mySelected,]
fileNames <- row.names(myTargets)

# Obtenemos el nombre completo de los archivos .CEL
all_files <- list.files("raw_data/", pattern = "*.CEL.gz", full.names = FALSE) # Todos
selectFiles <- c() # Los que se necesitan
for(i in 1:length(all_files)){
  fullName = all_files[i]
  name = unlist(strsplit(fullName,"_"))[1] 
  if(is.element(name,fileNames)){ # Si el nombre está en nuestro listado entonces lo añadimos
    selectFiles <- c(selectFiles,fullName)
  }
}

# Por último leemos los archivos .CEL que nos interesa y creamos un objeto de tipo AffyBatch
rawData <- read.affybatch(filenames = file.path(rawDataDir,selectFiles),phenoData=AnnotatedDataFrame(myTargets))

# Normalización
processedData <- affy::rma(rawData)

# Para tener unos nombres más intuitivos
myTargets$title->colnames(exprs(rawData))


# Los grupos presentes en el experimento son
#unique(myTargets['karyotype'])

# Tipo de placa
#cdfName(rawData)
```

```{r qcRaw}
library(simpleaffy)
library(affyPLM)

# Diagrama de cajas para obtener una idea de las distribución de las intensidades de las distintas muestras
boxplot(rawData, cex.axis=0.8, las=2, col=c(rep("red", 6), rep("blue", 6), rep("green", 6)),main="Distribución de los valores de intensidad en crudo")

# Histograma para conocer si las distribuciones de los distintos arrays son similares
hist(rawData)

# Cluster jerarquico
plot(hclust(dist(t(exprs(rawData))),method = "average"))

# Hacemos Anális de Comonentes Principales (PCA)
PCA_s <- prcomp(t(exprs(rawData)))
plot(PCA_s$x[, 1:2],pch=18, col="blue")
text(PCA_s$x[, 1:2], row.names(PCA_s$x), cex=0.7, pos=4, offset = 0,col="red")

# Control de calidad en crudo
qualityAnalysisRaw <- qc(rawData)
plot(qualityAnalysisRaw)
```

```{r }
# Para tener unos nombres más intuitivos
#myTargets$title->
colnames(processedData)<-myTargets$title
boxplot(processedData, cex.axis=0.8, las=2, col=c(rep("red", 6), rep("blue", 6), rep("green", 6)),main="Distribución de los valores de intensidad en crudo")

```


```{r gde}

```
